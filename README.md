# HP42S-free42

![hp42s-free42-extension-logo](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/vscode-hp42s-free42-logo.png)


![License](https://img.shields.io/github/license/heilingbrunner/vscode-hp42s-free42.svg?style=flat)
[![Version](https://img.shields.io/visual-studio-marketplace/v/JHeilingbrunner.vscode-hp42s-free42.svg?label=Version&style=flat)](https://marketplace.visualstudio.com/items?itemName=JHeilingbrunner.vscode-hp42s-free42)
[![Installs](https://img.shields.io/visual-studio-marketplace/i/JHeilingbrunner.vscode-hp42s-free42.svg?label=Installs&style=flat)](https://marketplace.visualstudio.com/items?itemName=JHeilingbrunner.vscode-hp42s-free42)
[![Rating](https://img.shields.io/visual-studio-marketplace/r/JHeilingbrunner.vscode-hp42s-free42.svg?label=Rating&style=flat)](https://marketplace.visualstudio.com/items?itemName=JHeilingbrunner.vscode-hp42s-free42)


Language support for [RPN](https://en.wikipedia.org/wiki/Reverse_Polish_notation) programming language on the HP42S/free42 calculators.

## What's new in HP42S-free42:

- refactoring code based parsers, with generated PEG parsers using grammars from [peggy.js](https://peggyjs.org/)
- improved log with more details for error analysis
- more commands until free42 __v3.3.5__
- package updates
- comments only using `//`

## Usage

Format -> Encode -> Decode -> Encode -> ...

![Demo](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/demo.gif)

![Syntax-check](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/syntx-check.png)

![Syntax-check](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/completion-label.png)

## Features

- syntax highlighting
- syntax checking
- string length checking
- label suggestions
- snipptes with description
- comments
- document formatter
- encoding code to raw
- decoding raw to code
- generated parsers from grammars
  
Supported filetypes:

- __`*.hp42s`__ for the __original__ operation set of the __HP-42S__
- __`*.free42`__ for the __extended__ operation set of the __free42__
- __`*.hex42`__ with detailed encoding/decoding information
- __`*.log`__ with detailed encoding/decoding progress when error occurs

## Limitations

- _Line numbers_: They are required for the HP42S/free42 code. They are generated by the formatter.
- _Single/Double Quotes_: The formatter will change outer double quotes to single quotes, when the string contains although double quotes (__"ABC"ABC"__ -> __'ABC"ABC'__).
- _Comments_: Comments only starts with `//`. Former comments with `@` or `#` are not supported anymore.

## `Encode Code from Editor`

Before encoding, please format the code. This avoids further special cases that would otherwise have to be taken into account.

- Press __Win/Linux__: `Ctrl+Shift+P`, __Mac-OSX__: `⇧⌘P`, then write `HP42S` to get the command `hp42s/free42: Encode Code from Editor` in the drop down list.
- The `hp42s/free42: Encode Code from Editor` command generates a `*.hp42s.raw` or `*.free42.raw` file. These files can be loaded by `free42` or `DM42`.
- Depending on the setting `HP42S/free42.encoderGenerateHexFile` setting, the command will generate a readable `hex42` file.
- Although the program size will be calculated and shown in the first line (`{ n-Byte Prgm }`). For some reason, the last ending `END` command is ignored. Real program size will be 3 bytes more.

  > __That's what the real HP-42S does. It is strange, since the END is, in fact, a part of the program... but that's the way it is.__

  ![Encode Code from Editor](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/encode-code.gif)

  ![Encode Error](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/encode-error.gif)

  ![Encode Log](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/encode-log.png)

## `Decode Code from Editor`

From a `*.raw` file the decoder generates the following files

- `*.hex42`: The sequence of the command bytes, when setting `HP42S/free42.decoderGenerateHexFile` is checked.
- `*.hp42s`: The code file with only pure HP42S commands.
- `*.free42`: The decode has detected free42 commands. The code will only run on free42 applications.

  ![Decode Code from Editor](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/decode-raw.gif)

  ![Decode Error](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/decode-error.gif)

  ![Decode Log](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/decode-log.png)

## The endless chain of encoding and decoding

Each operation creates new files with additional file extensions appended.

```
  Format           ->    Encode                        ->    Decode                                  ->    Encode  ...

         '*.hp42s' -> '*.hp42s.hex42' -> '*.hp42s.raw' -> '*.hp42s.raw.hex42' -> '*.hp42s.raw.hp42s' ->            ...
```

## Features

### Instruction sets

- HP42S instruction set
- [Free42 Extensions to the HP-42S Instruction Set](https://thomasokken.com/free42/#extensions)

### Syntax Highligthing

- Syntax highlighting for the HP42S and free42 commands

  ![Syntax Highligthing](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/syntax-highlighting.gif)

### Snippets with description

- Every keystroke command and its variations with a description.

  ![Snippets with description](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/snippets-with-description.gif)

- Normal snippets appear when writing the command
- Snippets for commands with leading special character appear when writing the command name (eg: use `DEC` for `→DEC`, use `REG` for `ΣREG`)
- Use `e`, `ᴇ` or `E` for `ᴇ` in `1.2ᴇ-23`
- Use `OP` for `×,÷,+/-,Σ+,Σ-,←,↑,↓,→,%,⊢,%CH`
- Use `FLAG` for all flags `01` to `99`
- Use `FOC` for `√,∫,░,Σ,▶,π,¿,␊,≤,≥,≠,↵,↓,→,←,µ,£,°,Å,Ñ,Ä,∡,ᴇ,Æ,…,␛,Ö,Ü,▒,■`
- Use `[LF]` or `␊` for a line feed in a string. Formatter will replace `[LF]` to `␊`.

### Comments

- Comments complete line with `//`
- Comments at end of line with `//`

  ![Comments](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/comments.png)

### Document Formatter

- The formatter prepares the code for encoding. 
- It will replace all abbreviations, which are used for ascii text editing. 
- When using __Visual Studio Code__, the code is displayed in UTF8, though all original characters of the HP42S/free42 can be displayed correct.

  > __However when I enter a program manually into a real calculator it helps to have line numbers. If I miss a command it helps to find the error.__

- Right-click in the editor to get the context menu, then select menu `Format Document` or press keyboard-shortcut __Win__: `SHIFT+ALT+F`/ __Linux__: `SHIFT+ALT+F`/ __Mac-OSX__: `⇧⌥F`.

  ![Document Formatter](https://raw.githubusercontent.com/heilingbrunner/vscode-hp42s-free42/master/images/document-formatter.gif)

The formatter has several settings:

- `Remove Too Long Spaces`: This will reduce whitespaces in the code.
- `Replace Abbreviations`: Abbreviations for special characters will be replaced by the correct intended character.
- `Trim Line`: This removes whitespaces at the beginnning and at the end of a code line.

The `hex42` files has these additional settings:

- `Use Line Numbers`: This will insert the leading line numbers.


## Resources

- [Hewlett Packard HP-42S](https://en.wikipedia.org/wiki/HP-42S) calculators, 
- [SwissMicros-DM42](https://www.swissmicros.com/dm42.php) calculators
- [FREE42](http://thomasokken.com/free42/) applications.
- [Thomas Okken - free42](http://thomasokken.com/free42/)
- [SwissMicros](https://www.swissmicros.com/)
- [SwissMicros - Forum](https://forum.swissmicros.com/viewtopic.php?f=2&t=2011)
- [MoHPC, The Museum of HP Calculators](http://www.hpmuseum.org/)
- [MoHPC - Forum](http://www.hpmuseum.org/forum/thread-11743.html)
- [FOCAL character set](https://en.wikipedia.org/wiki/FOCAL_character_set)
- [Hewlett-Packard HP-42S RPN Scientific Calculator Owner´s Manual](http://www.hp41.net/forum/fileshp41net/manuel-hp42s-us.pdf)
- [Hewlett-Packard HP-42S RPN Scientific Programming Examples and Techniques](http://www.hp41.net/forum/fileshp41net/hp42s-programming-examples.pdf)

## Requirements

None.

## Extension Settings

Encoding Settings:

- `HP42S/free42.encodergenerateHexFile`: This will although generate a `*.hex42` file, to see the correct hex encoding.

Decoding Settings:

- `HP42S/free42.decodergenerateHexFile`: This will although generate a `*.hex42` file, to see the correct hex encoding.
  
Document Formatter Settings:

- `HP42S/free42.formatterReplaceAbreviations`: see above __Document Formatter__
- `HP42S/free42.formatterRemoveTooLongSpaces`: see above __Document Formatter__
- `HP42S/free42.formatterTrimLines`: see above __Document Formatter__
- `HP42S/free42.formatterUseWhitespaceBetweenHex`: see generated hex files

Hex42 File Settings:

- `HP42S/free42.hex42UseLineNumbers`: see above __Hex42 Formatter__
